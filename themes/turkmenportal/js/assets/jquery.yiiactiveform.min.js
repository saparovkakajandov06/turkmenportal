!function(a){var b=function(a){var b,c=[];if(a.length)return"span"===a[0].tagName.toLowerCase()?(a.find(":checked").each(function(){c.push(this.value)}),c.join(",")):(b=a.attr("type"),"checkbox"===b||"radio"===b?a.filter(":checked").val():a.val())};a.fn.yiiactiveform=function(c){return this.each(function(){var d=a.extend({},a.fn.yiiactiveform.defaults,c||{}),e=a(this);void 0===d.validationUrl&&(d.validationUrl=e.attr("action")),a.each(d.attributes,function(c){this.value=b(e.find("#"+this.inputID)),d.attributes[c]=a.extend({},{validationDelay:d.validationDelay,validateOnChange:d.validateOnChange,validateOnType:d.validateOnType,hideErrorMessage:d.hideErrorMessage,inputContainer:d.inputContainer,errorCssClass:d.errorCssClass,successCssClass:d.successCssClass,beforeValidateAttribute:d.beforeValidateAttribute,afterValidateAttribute:d.afterValidateAttribute,validatingCssClass:d.validatingCssClass},this)}),e.data("settings",d),d.submitting=!1;var f=function(c,f){f&&(c.status=2),a.each(d.attributes,function(){this.value!==b(e.find("#"+this.inputID))&&(this.status=2,f=!0)}),f&&(void 0!==d.timer&&clearTimeout(d.timer),d.timer=setTimeout(function(){d.submitting||e.is(":hidden")||(void 0===c.beforeValidateAttribute||c.beforeValidateAttribute(e,c))&&(a.each(d.attributes,function(){2===this.status&&(this.status=3,a.fn.yiiactiveform.getInputContainer(this,e).addClass(this.validatingCssClass))}),a.fn.yiiactiveform.validate(e,function(b){var f=!1;a.each(d.attributes,function(){2!==this.status&&3!==this.status||(f=a.fn.yiiactiveform.updateInput(this,b,e)||f)}),void 0!==c.afterValidateAttribute&&c.afterValidateAttribute(e,c,b,f)}))},c.validationDelay))};if(a.each(d.attributes,function(c,d){this.validateOnChange&&e.find("#"+this.inputID).change(function(){f(d,!1)}).blur(function(){2!==d.status&&3!==d.status&&f(d,!d.status)}),this.validateOnType&&e.find("#"+this.inputID).keyup(function(){d.value!==b(a(this))&&f(d,!1)})}),d.validateOnSubmit){e.on("mouseup keyup",":submit",function(){e.data("submitObject",a(this))});var g=!1;e.submit(function(){return g?(g=!1,!0):(void 0!==d.timer&&clearTimeout(d.timer),d.submitting=!0,void 0===d.beforeValidate||d.beforeValidate(e)?a.fn.yiiactiveform.validate(e,function(b){var c=!1;if(a.each(d.attributes,function(){c=a.fn.yiiactiveform.updateInput(this,b,e)||c}),a.fn.yiiactiveform.updateSummary(e,b),(void 0===d.afterValidate||d.afterValidate(e,b,c))&&!c){g=!0;var f=e.data("submitObject")||e.find(":submit:first");return void(f.length?f.click():e.submit())}d.submitting=!1}):d.submitting=!1,!1)})}e.bind("reset",function(){setTimeout(function(){a.each(d.attributes,function(){this.status=0;var c=e.find("#"+this.errorID),d=a.fn.yiiactiveform.getInputContainer(this,e);d.removeClass(this.validatingCssClass+" "+this.errorCssClass+" "+this.successCssClass),c.html("").hide(),this.value=b(e.find("#"+this.inputID))}),e.find("label, :input").each(function(){a(this).removeClass(d.errorCss)}),a("#"+d.summaryID).hide().find("ul").html(""),void 0===d.focus||window.location.hash||e.find(d.focus).focus()},1)}),void 0===d.focus||window.location.hash||e.find(d.focus).focus()})},a.fn.yiiactiveform.getInputContainer=function(a,b){return void 0===a.inputContainer?b.find("#"+a.inputID).closest("div"):b.find(a.inputContainer).filter(':has("#'+a.inputID+'")')},a.fn.yiiactiveform.updateInput=function(c,d,e){c.status=1;var f,g,h=!1,i=e.find("#"+c.inputID),j=e.data("settings").errorCss;return i.length&&(h=null!==d&&a.isArray(d[c.id])&&d[c.id].length>0,f=e.find("#"+c.errorID),g=a.fn.yiiactiveform.getInputContainer(c,e),g.removeClass(c.validatingCssClass+" "+c.errorCssClass+" "+c.successCssClass),g.find("label, :input").each(function(){a(this).removeClass(j)}),h?(f.html(d[c.id][0]),g.addClass(c.errorCssClass)):(c.enableAjaxValidation||c.clientValidation)&&g.addClass(c.successCssClass),c.hideErrorMessage||f.toggle(h),c.value=b(i)),h},a.fn.yiiactiveform.updateSummary=function(b,c){var d=a(b).data("settings"),e="";if(void 0!==d.summaryID){if(c){var f=[];for(var g in d.attributes)d.attributes[g].summary&&f.push(d.attributes[g].id);a.each(d.attributes,function(){a.inArray(this.id,f)!==-1&&a.isArray(c[this.id])&&a.each(c[this.id],function(a,b){e=e+"<li>"+b+"</li>"})})}a("#"+d.summaryID).toggle(""!==e).find("ul").html(e)}},a.fn.yiiactiveform.validate=function(c,d,e){var f=a(c),g=f.data("settings"),h=!1,i={};if(a.each(g.attributes,function(){var a,c=[];void 0===this.clientValidation||!g.submitting&&2!==this.status&&3!==this.status||(a=b(f.find("#"+this.inputID)),this.clientValidation(a,c,this),c.length&&(i[this.id]=c)),!this.enableAjaxValidation||c.length||!g.submitting&&2!==this.status&&3!==this.status||(h=!0)}),!h||g.submitting&&!a.isEmptyObject(i))return void(g.submitting?setTimeout(function(){d(i)},200):d(i));var j=f.data("submitObject"),k="&"+g.ajaxVar+"="+f.attr("id");j&&j.length&&(k+="&"+j.attr("name")+"="+j.attr("value")),a.ajax({url:g.validationUrl,type:f.attr("method"),data:f.serialize()+k,dataType:"json",success:function(b){null!==b&&"object"==typeof b?(a.each(g.attributes,function(){this.enableAjaxValidation||delete b[this.id]}),d(a.extend({},i,b))):d(i)},error:function(){void 0!==e&&e()}})},a.fn.yiiactiveform.getSettings=function(b){return a(b).data("settings")},a.fn.yiiactiveform.defaults={ajaxVar:"ajax",validationUrl:void 0,validationDelay:200,validateOnSubmit:!1,validateOnChange:!0,validateOnType:!1,hideErrorMessage:!1,inputContainer:void 0,errorCss:"error",errorCssClass:"error",successCssClass:"success",validatingCssClass:"validating",summaryID:void 0,timer:void 0,beforeValidateAttribute:void 0,afterValidateAttribute:void 0,beforeValidate:void 0,afterValidate:void 0,focus:void 0,attributes:[]}}(jQuery);